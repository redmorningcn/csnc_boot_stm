/*******************************************************************************
* Description  : osal虚拟时钟，需要精度要求不高的定时服务可在这里处理。
* Author       : 2018/5/11 星期五, by redmorningcn
*******************************************************************************/

/*******************************************************************************
 * INCLUDES
 */
#include <includes.h>


#ifdef VSC_INCLUDE_SOURCE_FILE_NAMES
const  CPU_CHAR  *app_task_tmr__c = "$Id: $";
#endif

#define APP_TASK_TMR_EN     DEF_ENABLED
#if APP_TASK_TMR_EN == DEF_ENABLED

/*******************************************************************************
 * CONSTANTS
 */
#define CYCLE_SAMPLE_MSEC_TICKS     (OS_CFG_TICK_RATE_HZ / 5)

     
/*******************************************************************************
 * MACROS
 */

/*******************************************************************************
 * TYPEDEFS
 */

/*******************************************************************************
 * LOCAL VARIABLES
 */


/*******************************************************************************
 * GLOBAL VARIABLES
 */

/*******************************************************************************
 * LOCAL FUNCTIONS
 */

/*******************************************************************************
 * GLOBAL FUNCTIONS
 */

/*******************************************************************************
 * EXTERN VARIABLES
 */

/*******************************************************************************/

/*******************************************************************************
* Description  : 时钟任务处理函数
* Author       : 2018/5/11 星期五, by redmorningcn
*******************************************************************************/
osalEvt  TaskTmrEvtProcess(osalTid task_id, osalEvt task_event)
{
    /***********************************************
    * 描述： 本任务看门狗标志置位
    */
    //OSSetWdtFlag(( OS_FLAGS     ) WDT_FLAG_TMR);
 
    /***************************************************************************
    * 描述： 
    */
    if( task_event & OS_EVT_TMR_MSEC ) {
   
        return ( task_event ^ OS_EVT_TMR_MSEC );
    }
    return 0;
}

/*******************************************************************************
* Description  : 时钟任务初始化
* Author       : 2018/5/11 星期五, by redmorningcn
*******************************************************************************/
void TaskInitTmr(void)
{    
    /***********************************************
    * 描述： 在看门狗标志组注册本任务的看门狗标志
    */
//    OSRegWdtFlag(( OS_FLAGS     )WDT_FLAG_TMR );
    
    /*************************************************
    * 描述：启动事件查询
    */
    osal_start_timerRl( OS_TASK_ID_TMR, OS_EVT_TMR_MSEC,CYCLE_SAMPLE_MSEC_TICKS);  
}

/*******************************************************************************
 * 				                    end of file                                *
 *******************************************************************************/
#endif